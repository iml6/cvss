from cveUtilities import *
import joblib

# --- Later: Load and predict ---
loaded_model = joblib.load("cve_attack_vector_model_full_before2025.pkl")

filelist="cve-list-with-cvss-08022025-2025.dat"

items = get_training_items(filelist)

correct=0
wrong=0

for item in items:
    print()
    #print(f"From CVSS: {item.av}")
    new_input = item.description

    probas = loaded_model.predict_proba([new_input])[0]  # probabilities for each class
    classes = loaded_model.classes_

    # Get top prediction and its confidence
    predicted_index = probas.argmax()
    predicted_label = classes[predicted_index]
    confidence = probas[predicted_index]
    #print(f"From Desc: {predicted_label} (confidence: {confidence:.2f})")

    # If you want to see all class probabilities:
    #for cls, prob in zip(classes, probas):
    #    print(f"{cls}: {prob:.2f}")
    if item.av == "Local" or item.av=="Physical":
        if item.av == predicted_label:
            correct +=1
        else:
            print(f"From CVSS: {item.av}")
            print(f"From Desc: {predicted_label} (confidence: {confidence:.2f})")
            wrong += 1

print(correct)
print(wrong)